#!/usr/bin/env bash
# colorscheme
#
# Switch colorscheme for Ghostty, Helix and Zellij simultaneously.
#
# Requirements:
#   brew install gnu-sed

set -euo pipefail

# Check for gsed (GNU sed)
if command -v gsed &>/dev/null; then
    SED=gsed
elif command -v sed &>/dev/null; then
    SED=sed
else
    echo "Error: sed not found" >&2
    exit 1
fi

colorscheme=${1:-}

config_home=${XDG_CONFIG_HOME:-"$HOME/.config"}

ghostty_config="$config_home/ghostty/config"
helix_config="$config_home/helix/config.toml"
zellij_config="$config_home/zellij/config.kdl"

if [ -z "$colorscheme" ]; then
    echo "Usage: colorscheme <colorscheme>"
    echo ""
    echo "Examples: colorscheme dracula"
    echo "          colorscheme tokyonight"
    echo "          colorscheme gruvbox"
    echo "          colorscheme catppuccin"
    exit 1
fi

# Map a short colorscheme name to the Ghostty theme name.
ghostty_theme_for() {
    case "$1" in
        tokyonight)
            echo "TokyoNight Moon"
            ;;
        gruvbox)
            echo "Gruvbox Material Dark"
            ;;
        dracula)
            echo "Dracula"
            ;;
        catppuccin)
            echo "Catppuccin Mocha"
            ;;
        *)
            echo "$1"
            ;;
    esac
}

# Map a short colorscheme name to the Helix theme name.
helix_theme_for() {
    case "$1" in
        tokyonight)
            echo "tokyonight_moon"
            ;;
        gruvbox)
            echo "gruvbox_dark_hard"
            ;;
        catppuccin)
            echo "catppuccin_mocha"
            ;;
        *)
            echo "$1"
            ;;
    esac
}

# Map a short colorscheme name to the Zellij theme name.
zellij_theme_for() {
    case "$1" in
        tokyonight)
            echo "tokyo-night"
            ;;
        catppuccin)
            echo "catppuccin-mocha"
            ;;
        *)
            echo "$1"
            ;;
    esac
}

ghostty_cs_change() {
    if [ ! -f "$ghostty_config" ]; then
        echo "ghostty config not found: $ghostty_config" >&2
        return 1
    fi

    ghostty_theme=$(ghostty_theme_for "$colorscheme")
    $SED -i -E "s/^theme\s*=.*/theme = \"$ghostty_theme\"/" "$ghostty_config"
    echo "Ghostty theme -> $ghostty_theme"
}

helix_cs_change() {
    if [ ! -f "$helix_config" ]; then
        echo "helix config not found: $helix_config" >&2
        return 1
    fi

    helix_theme=$(helix_theme_for "$colorscheme")
    $SED -i -E "s/^theme\s*=.*/theme = \"$helix_theme\"/" "$helix_config"
    echo "Helix  theme -> $helix_theme"
}

zellij_cs_change() {
    if [ ! -f "$zellij_config" ]; then
        echo "zellij config not found: $zellij_config" >&2
        return 1
    fi

    zellij_theme=$(zellij_theme_for "$colorscheme")
    $SED -i -E "s/^theme\s+\"[^\"]*\"/theme \"$zellij_theme\"/" "$zellij_config"
    echo "Zellij theme -> $zellij_theme"
}

ghostty_cs_change
helix_cs_change
zellij_cs_change

exit 0
