#!/usr/bin/env bash
# font-size
#
# Change font size of Ghostty.
#
# Requirements:
#   brew install gnu-sed

set -euo pipefail

# Check for gsed (GNU sed)
if command -v gsed &>/dev/null; then
    SED="gsed"
elif command -v sed &>/dev/null; then
    SED="sed"
else
    echo "Error: sed not found" >&2
    exit 1
fi

to_font_size=${1:-}

config_home=${XDG_CONFIG_HOME:-"$HOME/.config"}
ghostty_config="$config_home/ghostty/config"

if [ "$#" -ne 1 ]; then
    if [ -f "$ghostty_config" ]; then
        current=$(grep -E '^font-size\s*=' "$ghostty_config" | $SED -E 's/^font-size\s*=\s*//' | head -1)
        echo "Current font size: ${current:-not set}"
    fi
    echo "Usage: font-size <1-200>"
    exit 0
fi

if [ "$to_font_size" -lt 1 ] || [ "$to_font_size" -gt 200 ]; then
    echo "font size must between 1 and 200"
    exit 1
fi

change_ghostty_font_size() {
    if [ ! -f "$ghostty_config" ]; then
        echo "ghostty config not found: $ghostty_config" >&2
        return 1
    fi

    if grep -qE '^font-size\s*=' "$ghostty_config"; then
        $SED -i -E "s/^font-size\s*=\s*.*/font-size = $to_font_size/" "$ghostty_config"
    else
        printf '\nfont-size = %s\n' "$to_font_size" >> "$ghostty_config"
    fi
}

change_ghostty_font_size

exit 0
